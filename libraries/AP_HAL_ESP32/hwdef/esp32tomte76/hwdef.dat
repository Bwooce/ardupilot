# ArduPilot Hardware Definition for ESP32-Tomte76 Board
# Based on ESP32 Classic with MPU9250 SPI, BMP280 I2C, and SD card support
# This is tomte76's version of esp32empty for use with AliExpress WROOM32 devkit clone
# Features: MPU9255 SPI, BMP280 I2C, micro SD on SPI2, NEO M8 GPS on UART

MCU ESP32

# Board identification
define HAL_ESP32_BOARD_NAME "esp32-tomte76"

# Sensor probe helper macros for easier configuration
define PROBE_IMU_SPI(driver, devname, args ...) ADD_BACKEND(AP_InertialSensor_ ## driver::probe(*this,hal.spi->get_device(devname),##args))
define PROBE_MAG_IMU(driver, imudev, imu_instance, args ...) ADD_BACKEND(DRIVER_ ##driver, AP_Compass_ ## driver::probe_ ## imudev(imu_instance,##args))
define PROBE_BARO_I2C(driver, bus, addr, args ...) ADD_BACKEND(AP_Baro_ ## driver::probe(*this,std::move(GET_I2C_DEVICE(bus, addr)),##args))

# IMU Configuration - MPU9250/MPU9255 via SPI (default)
define HAL_INS_DEFAULT HAL_INS_MPU9250_SPI
define HAL_INS_MPU9250_NAME "mpu9250"
define HAL_INS_PROBE_LIST PROBE_IMU_SPI(Invensense, HAL_INS_MPU9250_NAME, ROTATION_NONE)

# Alternative IMU configurations (uncomment to use):
# For different rotations if board mounted differently:
# define HAL_INS_PROBE_LIST PROBE_IMU_SPI(Invensense, HAL_INS_MPU9250_NAME, ROTATION_ROLL_180)
# define HAL_INS_PROBE_LIST PROBE_IMU_SPI(Invensense, HAL_INS_MPU9250_NAME, ROTATION_YAW_270)

# Compass Configuration - AK8963 integrated in MPU9250
define ALLOW_ARM_NO_COMPASS 1
define HAL_MAG_PROBE_LIST PROBE_MAG_IMU(AK8963, mpu9250, 0, ROTATION_NONE)

# Alternative compass configurations (uncomment to use):
# For different rotations:
# define HAL_MAG_PROBE_LIST PROBE_MAG_IMU(AK8963, mpu9250, 0, ROTATION_ROLL_180)
# define HAL_MAG_PROBE_LIST PROBE_MAG_IMU(AK8963, mpu9250, 0, ROTATION_YAW_270)

# Barometer Configuration - BMP280 via I2C at address 0x76
define HAL_BARO_ALLOW_INIT_NO_BARO 1
define HAL_BARO_PROBE_LIST PROBE_BARO_I2C(BMP280, 0, 0x76)

# Alternative barometer configurations (uncomment to use):
# For different I2C addresses:
# define HAL_BARO_PROBE_LIST PROBE_BARO_I2C(BMP280, 0, 0x77)

# WiFi Configuration
# 1 = TCP mode (default for tomte76 board)
define HAL_ESP32_WIFI 1
define WIFI_SSID "ardupilot123"
define WIFI_PWD "ardupilot123"

# WiFi Usage Notes:
# - 1 = TCP mode, 2 = UDP mode, comment out = WiFi disabled
# - Client connects to 192.168.4.1 port 14550
# - To disable MAVLink over USB: Set SERIAL0_PROTOCOL = 0

# ADC Configuration - disabled (no analog sensors on this board)
# NOTE: ADC disabled to avoid conflicts and save resources
define HAL_DISABLE_ADC_DRIVER 1
define HAL_USE_ADC 0

# Alternative ADC configuration (uncomment to enable if needed):
# define HAL_USE_ADC 1
# Available ADC1 pins: 32, 33, 34, 35, 36, 39 (ADC2 unavailable with WiFi)

# LED Configuration - no external LEDs on this DIY board
define BUILD_DEFAULT_LED_TYPE Notify_LED_None

# Alternative LED configurations (uncomment to use):
# For boards with external LEDs:
# define BUILD_DEFAULT_LED_TYPE Notify_LED_WS2812
# define BUILD_DEFAULT_LED_TYPE Notify_LED_NeoPixel

# Storage Configuration - SD Card via SPI
# Uses HSPI (SPI2) to avoid conflict with MPU9250 on VSPI (SPI3)
define HAL_ESP32_SDCARD 1
define HAL_LOGGING_FILESYSTEM_ENABLED 1
define HAL_LOGGING_DATAFLASH_ENABLED 0  
define HAL_LOGGING_MAVLINK_ENABLED 0
define HAL_BOARD_LOG_DIRECTORY "/SDCARD/APM/LOGS"
define HAL_BOARD_STORAGE_DIRECTORY "/SDCARD/APM/STORAGE"
define HAL_BOARD_TERRAIN_DIRECTORY "/SDCARD/APM/TERRAIN"
define HAL_LOGGING_BACKENDS_DEFAULT 1

# Storage Configuration Notes:
# - SD card configured for SPI mode using HSPI host
# - MMC mode not used to allow flexible pin assignment
# - Logging backend 1 = filesystem (SD card)
# - Alternative: set HAL_LOGGING_BACKENDS_DEFAULT 2 for MAVLink logging

# RMT (Remote Control) receiver input pin
define HAL_ESP32_RMT_RX_PIN_NUMBER 4

# Pin Configuration for ESP32-Tomte76 Board
# Optimized for AliExpress WROOM32 devkit with external sensors

# I2C Bus Configuration
# Bus 0: SDA=GPIO21, SCL=GPIO22 (standard ESP32 DevKit pins)
# Used for BMP280 barometer at address 0x76
I2C_ORDER I2C0
I2C0_SDA_PIN 21
I2C0_SCL_PIN 22
I2C0_SPEED 400000
I2C0_INTERNAL 1

# Alternative I2C configurations:
# For different pin assignments, modify GPIO numbers above
# Standard DevKit alternatives: SDA(4,5,13), SCL(15,18,19)

# UART Configuration
# SERIAL0: TX=GPIO1, RX=GPIO3 (USB programming/debug console)
# SERIAL1: TX=GPIO17, RX=GPIO16 (NEO M8 GPS connection)
UART_ORDER SERIAL0 SERIAL1
SERIAL0_TX_PIN 1
SERIAL0_RX_PIN 3
SERIAL1_TX_PIN 17
SERIAL1_RX_PIN 16

# Alternative UART configurations:
# GPS can be moved to different pins if needed
# Common ESP32 UART pins: TX(2,4,12,14), RX(13,15,16,17)

# RCOUT Configuration (servo/motor outputs)
# 4 channels: GPIO25, GPIO27, GPIO33, GPIO32
RCOUT1_PIN 25
RCOUT2_PIN 27
RCOUT3_PIN 33
RCOUT4_PIN 32

# Alternative RCOUT configurations:
# For different pin assignments: 2, 4, 12, 13, 14, 15, 16, 17
# Avoid strapping pins: 0, 2, 5, 12, 15

# RCIN Configuration (receiver input)
# GPIO36 - input-only pin, good for receiver input
RCIN_PIN 36

# Alternative RCIN configurations:
# Other input-only pins: 34, 35, 39
# Regular GPIO pins can also be used: 4, 16, 17

# SPI1 Bus - VSPI for MPU9250 IMU
# Standard VSPI pins for ESP32 DevKit
SPI1_SCK_PIN 18
SPI1_MISO_PIN 19
SPI1_MOSI_PIN 23
MPU9250_CS_PIN 5

# Alternative SPI1 configurations:
# CS pin can be any available GPIO: 2, 4, 12, 13, 14, 15, 16, 17
# VSPI pins are fixed: SCK=18, MISO=19, MOSI=23

# SD Card SPI Configuration (HSPI/SPI2)
# Uses HSPI to avoid conflicts with MPU9250 on VSPI
# DMA channel 1 for high-speed transfers
SPI2_MOSI_PIN 13
SPI2_MISO_PIN 12
SPI2_SCK_PIN 14
SPI2_CS_PIN 15

# Alternative SD Card SPI configurations:
# HSPI pins are fixed: MOSI=13, MISO=12, SCK=14
# CS pin can be any available GPIO
# For MMC mode instead (faster but fixed pins):
# Comment out SPI2 lines and uncomment: define HAL_ESP32_SDMMC 1