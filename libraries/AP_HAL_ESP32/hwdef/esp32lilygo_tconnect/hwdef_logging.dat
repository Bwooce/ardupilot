# ESP32 Internal Flash Logging Configuration
# This file contains the changes needed to enable logging to internal flash

# Storage configuration - Enable filesystem logging to internal flash
define HAL_LOGGING_DATAFLASH_ENABLED 0
define HAL_LOGGING_FILESYSTEM_ENABLED 1
define HAL_LOGGING_MAVLINK_ENABLED 1
# Enable both filesystem and MAVLink logging (bit 1 = File, bit 2 = MAVLink)
define HAL_LOGGING_BACKENDS_DEFAULT 3

# Storage directories for SPIFFS/LittleFS
define HAL_BOARD_LOG_DIRECTORY "/APM/LOGS"
define HAL_BOARD_TERRAIN_DIRECTORY "/APM/TERRAIN"

# Disable SD card - we're using internal flash
define HAL_ESP32_SDCARD 0

# Enable SPIFFS filesystem for internal flash storage
define HAL_ESP32_STORAGE_TYPE 1  # 0=SD, 1=SPIFFS, 2=LittleFS

# SPIFFS Configuration
define HAL_ESP32_SPIFFS_MOUNT_POINT "/APM"
define HAL_ESP32_SPIFFS_MAX_FILES 10
define HAL_ESP32_SPIFFS_FORMAT_IF_FAILED 1

# Reserve space for logging in the partition table
# With 16MB flash, we can allocate several MB for logs
# Typical partition layout:
# - App0: 3MB
# - App1: 3MB (OTA)
# - NVS: 16KB
# - PHY: 4KB
# - SPIFFS: 8MB+ (for logs and storage)
define HAL_ESP32_SPIFFS_SIZE_MB 8

# Log file configuration
define HAL_LOGGER_FILE_BUFSIZE 200  # Smaller buffer for flash writes
define HAL_LOGGER_WRITE_CHUNK_SIZE 512  # Flash-friendly write size

# Enable filesystem operations
define HAL_OS_FATFS_IO 1
define HAL_HAVE_FILESYSTEM_SUPPORT 1