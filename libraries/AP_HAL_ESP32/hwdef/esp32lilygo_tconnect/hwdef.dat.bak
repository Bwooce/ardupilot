# LilyGo T-Connect ESP32-S3 board configuration
MCU ESP32S3
define HAL_BOARD_SUBTYPE 24

# CPU speed and memory configuration
CPU_CLOCK_MHZ 240
FLASH_SIZE_MB 16
STORAGE_FLASH_PAGE 256

# Serial protocol defaults
define DEFAULT_SERIAL1_PROTOCOL SerialProtocol_MAVLink2
define DEFAULT_SERIAL2_PROTOCOL SerialProtocol_GPS

# Storage configuration - Use PSRAM for in-memory logging
define HAL_USE_PSRAM 1
define HAL_STORAGE_PSRAM_SIZE 8388608

# Serial interfaces
# SERIAL0 is USB (built-in)
UART_ORDER SERIAL0 SERIAL1 SERIAL2
SERIAL0_TX_PIN 21  # USB-Serial/JTAG
SERIAL0_RX_PIN 20  # USB-Serial/JTAG
SERIAL0_BAUD 460

# SERIAL1 for telemetry
SERIAL1_TX_PIN 12
SERIAL1_RX_PIN 46
SERIAL1_BAUD 460

# SERIAL2 for GPS - using alternative pins
SERIAL2_TX_PIN 43
SERIAL2_RX_PIN 44  
SERIAL2_BAUD 38400

# I2C bus configuration - for external sensors
I2C_ORDER I2C1 I2C2
I2C1_SDA_PIN 5    # For barometer and other sensors
I2C1_SCL_PIN 6
I2C2_SDA_PIN 39   # For compass and external devices
I2C2_SCL_PIN 40

# CAN interface - CAN_H on HW3, CAN_L on HW4
CAN_ORDER 1
HAL_CAN1_TX_PIN 7  # CAN_TX (HW3 - CAN_H)
HAL_CAN1_RX_PIN 8  # CAN_RX (HW4 - CAN_L)

# SPI bus configuration (3 buses available)
SPI_ORDER SPI0 SPI1 SPI2
SPI0_MISO_PIN 10
SPI0_MOSI_PIN 11  
SPI0_SCK_PIN 9
SPI0_CS_PIN 15    # Chip select for first SPI device

SPI1_MISO_PIN 37
SPI1_MOSI_PIN 35
SPI1_SCK_PIN 36
SPI1_CS_PIN 34    # Chip select for second SPI device

SPI2_MISO_PIN 17
SPI2_MOSI_PIN 18
SPI2_SCK_PIN 16
SPI2_CS_PIN 14    # Chip select for third SPI device

# ESP32-specific features
define HAL_ESP32_WIFI 1

# Additional board-specific defines
define HAL_PROBE_EXTERNAL_I2C_COMPASSES 1
define HAL_BARO_ALLOW_INIT_NO_BARO 1
define HAL_AIRSPEED_BUS_DEFAULT 0

# Disable unused features to save memory
define HAL_PARACHUTE_ENABLED 0
define HAL_SPRAYER_ENABLED 0

# Enable CAN features
define HAL_PICCOLO_CAN_ENABLE 0
define HAL_TORQEEDO_ENABLED 0
define HAL_EFI_ENABLED 0

# Use a smaller buffer for MAVLink to save memory
define HAL_MAVLINK_BINDINGS_ENABLED 1

# For different UART pins if needed:
# SERIAL1_TX_PIN 17, SERIAL1_RX_PIN 18 (alternative pins)
# SERIAL2_TX_PIN 1, SERIAL2_RX_PIN 2 (alternative pins)

# Storage configuration options:
# These defines enable different storage backends:
# - If both undefined or set to 0: NVS storage only (limited to 8KB)
# - If HAL_USE_PSRAM=1: PSRAM storage (8MB virtual storage)
# - If HAL_USE_FILE_STORAGE=1: File-based storage (requires SD card or SPIFFS)

# Default parameters (optional)
# DEFAULTS libraries/AP_HAL_ESP32/hwdef/esp32lilygo_tconnect/defaults.parm

# Setup for serial logging and debugging
define HAL_OS_POSIX_IO 1
define HAL_OS_FATFS_IO 0

# Low noise modes and safety features
define HAL_QUIET_NANF 1
define FORCE_VERSION_H_INCLUDE 1

# Performance tuning
define SCHEDULER_LOOP_RATE 400
